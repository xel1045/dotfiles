#!/usr/bin/env php
<?php

$projectsPath = $_SERVER['HOME'] . '/Documents/Projets';
$desktopPath  = $_SERVER['HOME'] . '/Desktop';

//==============================================================================

$projectsPath = realpath($projectsPath) . '/';
$desktopPath  = realpath($desktopPath) . '/';


set_time_limit(0);
date_default_timezone_set('America/Montreal');
setlocale(LC_ALL, 'fr_CA');

$projectFormatter = new IntlDateFormatter('fr_CA', IntlDateFormatter::NONE, IntlDateFormatter::NONE, null, null, 'YYYY MMMM');
$desktopFormatter = new IntlDateFormatter('fr_CA', IntlDateFormatter::NONE, IntlDateFormatter::NONE, null, null, 'MMMM YYYY');

// 1. Create folder in the projects folder
$projectName = ucwords($projectFormatter->format(time()));

if (! file_exists($projectsPath . $projectName)) {
	echo 'Creating project folder  '. $projectName.PHP_EOL;
	mkdir($projectsPath . $projectName);
}

// 2. Add a shortcut to the desktop
$desktopName = ucwords($desktopFormatter->format(time()));
if (! file_exists($desktopPath . $desktopName)) {
	symlink($projectsPath . $projectName, $desktopPath . $desktopName);
}

// 3. Archive old shortchuts on the desktop (up to 12 months)
for ($i=1; $i<12; $i++) {
	$archiveDate = new DateTime();
	$archiveDate->sub(DateInterval::createFromDateString($i . ' month'));

	$archiveDesktopName = ucwords($desktopFormatter->format($archiveDate));

	if (file_exists($desktopPath . $archiveDesktopName)) {
		unlink($desktopPath . $archiveDesktopName);
	}
}
